# BasisPilot 全生命周期面板设计方案

> 基于 Mem0 记忆系统的学生全生命周期可视化面板

## 1. 概述

BasisPilot 面板覆盖 BASIS 学生从入学到毕业的完整旅程，数据来源于 Mem0 记忆存储（Qdrant）、`student_profiles` 表和 `usage_logs` 表。面板按四大产品入口组织，与前端 `landing/page.tsx` 的 PRODUCTS 一一对应。

---

## 2. 四大产品 × 面板模块

### 2.1 AI 学伴 (tutoring)

**对应前端产品**: BookOpen 图标 — AI 学伴
**记忆 category**: `tutoring`

| 面板模块 | 数据来源 | 可视化组件 |
|---------|---------|-----------|
| 学科雷达图 | 记忆中 subject 分布 + 提问频率 | Radar Chart |
| 知识点掌握热力图 | 记忆中 tutoring 类别关键词聚合 | Heatmap |
| 提问历史趋势 | usage_logs.agent_calls 按日聚合 | Line Chart |
| 薄弱/优势学科 | student_profiles.weak/strong_subjects | Tag Cloud |

**记忆内容示例**:
- "学生在 AP Calculus BC 的 Taylor Series 理解较弱"
- "偏好用中文解释概念，英文做练习"
- "数学计算能力强，Word Problems 是薄弱环节"

### 2.2 升学规划师 (college_planning)

**对应前端产品**: GraduationCap 图标 — 升学规划师
**记忆 category**: `college_planning`

| 面板模块 | 数据来源 | 可视化组件 |
|---------|---------|-----------|
| 申请时间线 | 记忆中里程碑事件 + timestamp | Timeline |
| 竞争力仪表盘 | GPA + AP 数量 + 课外活动综合评分 | Gauge / Score Card |
| GPA 趋势图 | 记忆中 grade 类别 + student_profiles.current_gpa | Line Chart |
| AP 选课路径 | student_profiles.ap_courses + 记忆建议 | Flow Diagram |

**记忆内容示例**:
- "目标大学: UC Berkeley, UCLA, UCSB"
- "G10 计划选 AP Physics C + AP Chemistry + AP US History"
- "课外活动: 数学竞赛 AMC/AIME, 机器人社团"

### 2.3 新生衔接营 (onboarding)

**对应前端产品**: Users 图标 — 新生衔接营
**记忆 category**: `onboarding`

| 面板模块 | 数据来源 | 可视化组件 |
|---------|---------|-----------|
| 适应进度条 | 衔接课程完成度 | Progress Bar |
| 衔接清单完成度 | 记忆中 onboarding 事项打勾状态 | Checklist |
| 入学准备度评分 | 入学评估 + 预习覆盖率 | Score Card |
| 预习覆盖率 | 按学科统计预习章节比例 | Stacked Bar |

**记忆内容示例**:
- "从深圳外国语转入 BASIS 蛇口，G8"
- "数学水平: Algebra I 已掌握，Geometry 需要补"
- "英语阅读速度偏慢，需要加强学术词汇"

### 2.4 AP 冲刺包 (exam_prep)

**对应前端产品**: Target 图标 — AP 冲刺包
**记忆 category**: `exam_prep`

| 面板模块 | 数据来源 | 可视化组件 |
|---------|---------|-----------|
| AP 分数趋势 | 模考成绩历史记忆 | Line Chart |
| 知识点薄弱分布 | FRQ 易错点聚合 | Treemap |
| 备考进度 | 各科目刷题量 + 完成章节 | Multi-Progress |
| 考试倒计时 | 固定日历 (5月 AP 考试) | Countdown |

**记忆内容示例**:
- "AP Calculus BC 模考: 第一次 3 分, 第二次 4 分"
- "AP Chemistry FRQ 易错: 平衡常数计算、电化学"
- "AP US History DBQ 论证结构需要加强"

---

## 3. 跨产品通用分类

| category | 说明 | 面板可视化 |
|----------|------|-----------|
| `grade` | GPA 变化、单科成绩、Probation 状态 | GPA 折线图、成绩分布柱状图 |
| `assessment` | 评估报告结论、诊断结果 | 报告卡片、能力对比雷达图 |
| `preference` | 语言偏好、解题风格、学习时间 | 个性化设置面板 |
| `goal` | 短期/长期目标、里程碑 | 目标进度追踪、里程碑时间线 |

---

## 4. 记忆 metadata 完整结构

```python
metadata = {
    # ---- 系统字段 ----
    "source": "agent_explicit",       # agent_explicit / auto_capture / manual
    "basis_user_id": 42,              # biz_users.id (int)
    "timestamp": "2026-02-21T10:30:00+00:00",

    # ---- 分类维度 ----
    "category": "tutoring",           # tutoring/college_planning/onboarding/exam_prep
                                      # /grade/assessment/preference/goal
    "subject": "math",                # math/science/humanities/curriculum/general
    "importance": "high",             # high/medium/low
}
```

**设计原则**:
- `category` 对齐四大产品 + 四个通用维度，面板按此过滤
- `subject` 提供学科维度切片
- `importance` 用于排序和高亮展示
- `timestamp` 支持时间维度聚合和趋势分析

---

## 5. API 端点设计

所有端点需要 `Authorization: Bearer <token>` 认证，通过 `authenticate_request()` 提取 `user_id`。

### 5.1 综合面板

```
GET /api/dashboard/overview
```

**响应**:
```json
{
  "user_id": 42,
  "total_memories": 156,
  "categories": {
    "tutoring": { "count": 45, "last_updated": "2026-02-20T15:30:00Z" },
    "college_planning": { "count": 23, "last_updated": "2026-02-19T10:00:00Z" },
    "onboarding": { "count": 12, "last_updated": "2026-01-15T08:00:00Z" },
    "exam_prep": { "count": 34, "last_updated": "2026-02-21T09:00:00Z" },
    "grade": { "count": 18, "last_updated": "2026-02-18T14:00:00Z" },
    "goal": { "count": 8, "last_updated": "2026-02-10T11:00:00Z" }
  },
  "student_profile": { "grade": "G10", "gpa": 3.7, "academic_status": "normal" },
  "recent_activity": [...]
}
```

```
GET /api/dashboard/timeline?start=2025-09-01&end=2026-06-30
```

**响应**: 按时间排序的记忆事件流，用于渲染全生命周期时间线。

### 5.2 AI 学伴 (tutoring)

```
GET /api/dashboard/tutoring/subjects
```

**响应**:
```json
{
  "radar": {
    "math": { "questions": 120, "mastery": 0.75 },
    "science": { "questions": 85, "mastery": 0.68 },
    "humanities": { "questions": 45, "mastery": 0.55 }
  },
  "weak_subjects": ["humanities", "science"],
  "strong_subjects": ["math"]
}
```

```
GET /api/dashboard/tutoring/history?days=30
```

**响应**: 提问历史 + 知识点覆盖率的日级聚合数据。

### 5.3 升学规划 (college_planning)

```
GET /api/dashboard/college/roadmap
```

**响应**:
```json
{
  "milestones": [
    { "date": "2026-03-01", "event": "SAT 第一次考试", "status": "upcoming" },
    { "date": "2026-05-06", "event": "AP Calculus BC 考试", "status": "upcoming" }
  ],
  "target_colleges": ["UC Berkeley", "UCLA"],
  "current_competitiveness": 72
}
```

```
GET /api/dashboard/college/competitiveness
```

**响应**: 竞争力评分分解（GPA 权重、AP 数量权重、课外活动权重）。

### 5.4 新生衔接 (onboarding)

```
GET /api/dashboard/onboarding/progress
```

**响应**:
```json
{
  "overall_progress": 0.65,
  "courses": [
    { "name": "数学衔接", "progress": 0.8 },
    { "name": "英语学术写作", "progress": 0.5 },
    { "name": "科学实验方法", "progress": 0.6 }
  ]
}
```

```
GET /api/dashboard/onboarding/readiness
```

**响应**: 入学准备度评分 + 各维度细分。

### 5.5 AP 冲刺 (exam_prep)

```
GET /api/dashboard/exam/progress
```

**响应**:
```json
{
  "subjects": [
    {
      "name": "AP Calculus BC",
      "chapters_completed": 12,
      "total_chapters": 15,
      "practice_problems": 340,
      "accuracy": 0.82
    }
  ]
}
```

```
GET /api/dashboard/exam/scores
```

**响应**: 各科模考分数趋势 + 目标分对比。

### 5.6 成绩 & 报告

```
GET /api/dashboard/grades
```

**响应**: GPA 历史趋势 + 单科成绩分布。

```
GET /api/dashboard/report
```

**响应**: AI 生成的综合分析报告（基于全部记忆聚合）。

### 5.7 家长端

```
GET /api/dashboard/parent-summary
```

**响应**: 绑定学生的摘要视图，包含各维度关键指标。需验证 `parent_student_links` 关系。

---

## 6. 数据聚合逻辑

### 6.1 从记忆到面板数据

```
Agent 对话
  → remember_fact(content, category, subject, importance)
  → Mem0 存储到 Qdrant（附带 metadata）
  → Qdrant 支持 metadata 过滤查询

面板请求
  → server.py /api/dashboard/* 端点
  → Mem0 get_all(user_id, filters={"category": "tutoring"})
  → 按 subject/timestamp/importance 聚合
  → 返回结构化 JSON
  → 前端渲染可视化图表
```

### 6.2 聚合策略

| 维度 | 聚合方式 |
|------|---------|
| 按产品 | `category` 精确过滤 |
| 按学科 | `subject` 精确过滤 |
| 按时间 | `timestamp` 范围过滤 + 日/周/月聚合 |
| 按重要性 | `importance` 排序，high 优先展示 |
| 跨维度 | 多条件组合，如 `category=exam_prep AND subject=math` |

### 6.3 补充数据源

| 数据源 | 用途 |
|--------|------|
| `student_profiles` 表 | 结构化学生信息（GPA、AP 选课、学校等） |
| `usage_logs` 表 | 使用频率、Agent 调用分布 |
| `subscriptions` 表 | 付费状态决定面板功能权限 |

---

## 7. 前端组件结构

```
/app/dashboard/
├── page.tsx                     # 综合面板入口（Overview）
├── components/
│   ├── OverviewCards.tsx         # 四大产品概览卡片
│   ├── TimelineView.tsx         # 全生命周期时间线
│   ├── RadarChart.tsx           # 学科雷达图 (recharts)
│   ├── TrendLine.tsx            # 趋势折线图
│   ├── ProgressBar.tsx          # 进度条组件
│   ├── ScoreCard.tsx            # 评分卡片
│   ├── Heatmap.tsx              # 热力图
│   └── Countdown.tsx            # 考试倒计时
├── tutoring/
│   └── page.tsx                 # AI 学伴面板
├── college/
│   └── page.tsx                 # 升学规划面板
├── onboarding/
│   └── page.tsx                 # 新生衔接面板
├── exam/
│   └── page.tsx                 # AP 冲刺面板
└── parent/
    └── page.tsx                 # 家长端摘要
```

**推荐图表库**: `recharts`（React 生态，支持 Radar/Line/Bar/Treemap）

---

## 8. 角色权限矩阵

| 面板页面 | 学生 | 家长 | 教师/顾问 |
|---------|------|------|----------|
| 综合面板 Overview | 自己的数据 | 绑定学生的摘要 | 管辖学生聚合 |
| AI 学伴 Tutoring | 完整数据 | 学科分布摘要 | 班级学科对比 |
| 升学规划 College | 完整数据 | 关键里程碑 | 学生竞争力对比 |
| 新生衔接 Onboarding | 完整数据 | 进度摘要 | 班级适应度 |
| AP 冲刺 Exam | 完整数据 | 成绩趋势 | 科目通过率 |
| 成绩记录 Grades | 完整数据 | GPA 趋势 | 班级 GPA 分布 |
| 删除记忆 | 可以 | 不可以 | 不可以 |

**权限实现**: 基于 `biz_users.role` + `parent_student_links` 表判断访问权限。

---

## 9. 增值服务追踪

| 增值服务 (ADDONS) | category | 面板展示 |
|-------------------|----------|---------|
| 新生衔接营 2/4 周 | `onboarding` | 课程进度、每周完成度 |
| AP 冲刺包 单科/3科 | `exam_prep` | 刷题量、正确率趋势 |
| 学术评估报告 | `assessment` | 报告生成历史、能力变化 |
| 升学规划报告 | `college_planning` | 报告生成历史、竞争力变化 |

增值服务状态从 `purchases` 表获取，与记忆数据交叉展示。

---

## 10. 实施路线图

| 阶段 | 内容 | 依赖 |
|------|------|------|
| Phase 1 (当前) | Mem0 记忆集成 + metadata 结构预留 | 已完成 |
| Phase 2 | Dashboard API 端点 (server.py) | Mem0 数据积累 |
| Phase 3 | 前端面板组件开发 | Dashboard API |
| Phase 4 | 家长端视图 + 权限控制 | 角色系统完善 |
| Phase 5 | AI 生成综合报告 | 足够的记忆数据 |

---

*BasisPilot · 贝领 — Powered by xDAN AI 新旦智能 · Expert Digital Workforce*
